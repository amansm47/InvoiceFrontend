import axios from 'axios';\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n});\n\napi.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      localStorage.removeItem('token');\n      window.location.href = '/login';\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport const authAPI = {\n  login: (email, password) => \n    api.post('/auth/login', { email, password }).then(res => res.data),\n  \n  register: (userData) => \n    api.post('/auth/register', userData).then(res => res.data),\n  \n  updateKYC: (kycData) => \n    api.post('/auth/kyc', kycData).then(res => res.data),\n  \n  verifyToken: (token) => \n    api.get('/users/profile', { headers: { Authorization: `Bearer ${token}` } })\n      .then(res => res.data),\n\n  forgotPassword: (email) =>\n    api.post('/auth/forgot-password', { email }).then(res => res.data),\n\n  resetPassword: (token, password) =>\n    api.post('/auth/reset-password', { token, password }).then(res => res.data)\n};\n\nexport const invoiceAPI = {\n  // Upload invoice with file\n  uploadInvoice: (formData) => \n    api.post('/invoices/upload', formData, {\n      headers: { 'Content-Type': 'multipart/form-data' }\n    }).then(res => res.data),\n  \n  // Get seller's invoices\n  getSellerInvoices: () => \n    api.get('/invoices/seller').then(res => res.data),\n  \n  // Buyer confirmation\n  confirmInvoice: (invoiceId) => \n    api.post(`/invoices/${invoiceId}/confirm`).then(res => res.data),\n  \n  // Get marketplace with filters\n  getMarketplace: (filters = {}) => {\n    const params = new URLSearchParams();\n    Object.keys(filters).forEach(key => {\n      if (filters[key] && filters[key] !== 'all') {\n        params.append(key, filters[key]);\n      }\n    });\n    return api.get(`/invoices/marketplace?${params}`).then(res => res.data);\n  },\n  \n  // Fund invoice\n  fundInvoice: ({ invoiceId, amount }) => \n    api.post(`/invoices/${invoiceId}/fund`, { discountedAmount: amount }).then(res => res.data),\n  \n  // Get invoice details\n  getInvoiceDetails: (invoiceId) =>\n    api.get(`/invoices/${invoiceId}`).then(res => res.data),\n  \n  // Repay invoice\n  repayInvoice: (invoiceId, paymentData) => \n    api.post(`/invoices/${invoiceId}/repay`, paymentData).then(res => res.data),\n\n  // Get invoice analytics\n  getInvoiceAnalytics: (invoiceId) =>\n    api.get(`/invoices/${invoiceId}/analytics`).then(res => res.data),\n\n  // Auto-list pending invoices\n  autoListInvoices: () =>\n    api.post('/invoices/auto-list').then(res => res.data)\n};\n\nexport const userAPI = {\n  // Get user dashboard data\n  getDashboard: () => \n    api.get('/users/dashboard').then(res => res.data),\n  \n  // Get user profile\n  getProfile: () => \n    api.get('/users/profile').then(res => res.data),\n  \n  // Update profile\n  updateProfile: (profileData) => \n    api.put('/users/profile', profileData).then(res => res.data),\n  \n  // Get investment portfolio\n  getPortfolio: () => \n    api.get('/users/portfolio').then(res => res.data),\n  \n  // Get investment analytics\n  getAnalytics: () => \n    api.get('/users/analytics').then(res => res.data),\n\n  // Get wallet balance\n  getWalletBalance: () =>\n    api.get('/users/wallet').then(res => res.data),\n\n  // Add money to wallet\n  addMoney: (amount, paymentMethod) =>\n    api.post('/users/wallet/add', { amount, paymentMethod }).then(res => res.data),\n\n  // Withdraw money from wallet\n  withdrawMoney: (amount, bankDetails) =>\n    api.post('/users/wallet/withdraw', { amount, bankDetails }).then(res => res.data),\n\n  // Get transaction history\n  getTransactionHistory: (page = 1, limit = 20) =>\n    api.get(`/users/transactions?page=${page}&limit=${limit}`).then(res => res.data),\n\n  // Update notification preferences\n  updateNotificationPreferences: (preferences) =>\n    api.put('/users/notifications', preferences).then(res => res.data),\n\n  // Get KYC status\n  getKYCStatus: () =>\n    api.get('/users/kyc-status').then(res => res.data),\n\n  // Upload KYC documents\n  uploadKYCDocuments: (formData) =>\n    api.post('/users/kyc-upload', formData, {\n      headers: { 'Content-Type': 'multipart/form-data' }\n    }).then(res => res.data)\n};\n\nexport const paymentAPI = {\n  // Create payment order\n  createPaymentOrder: (amount, currency = 'INR') =>\n    api.post('/payments/create-order', { amount, currency }).then(res => res.data),\n\n  // Verify payment\n  verifyPayment: (paymentData) =>\n    api.post('/payments/verify', paymentData).then(res => res.data),\n\n  // Get payment methods\n  getPaymentMethods: () =>\n    api.get('/payments/methods').then(res => res.data),\n\n  // Process UPI payment\n  processUPIPayment: (upiId, amount, invoiceId) =>\n    api.post('/payments/upi', { upiId, amount, invoiceId }).then(res => res.data),\n\n  // Process bank transfer\n  processBankTransfer: (bankDetails, amount, invoiceId) =>\n    api.post('/payments/bank-transfer', { bankDetails, amount, invoiceId }).then(res => res.data)\n};\n\nexport const notificationAPI = {\n  // Get notifications\n  getNotifications: (page = 1, limit = 20) =>\n    api.get(`/notifications?page=${page}&limit=${limit}`).then(res => res.data),\n\n  // Mark notification as read\n  markAsRead: (notificationId) =>\n    api.put(`/notifications/${notificationId}/read`).then(res => res.data),\n\n  // Mark all notifications as read\n  markAllAsRead: () =>\n    api.put('/notifications/mark-all-read').then(res => res.data),\n\n  // Delete notification\n  deleteNotification: (notificationId) =>\n    api.delete(`/notifications/${notificationId}`).then(res => res.data)\n};\n\nexport const analyticsAPI = {\n  // Get market analytics\n  getMarketAnalytics: () =>\n    api.get('/analytics/market').then(res => res.data),\n\n  // Get platform statistics\n  getPlatformStats: () =>\n    api.get('/analytics/platform').then(res => res.data),\n\n  // Get risk analytics\n  getRiskAnalytics: () =>\n    api.get('/analytics/risk').then(res => res.data),\n\n  // Get performance metrics\n  getPerformanceMetrics: (userId, period = '30d') =>\n    api.get(`/analytics/performance/${userId}?period=${period}`).then(res => res.data)\n};\n\nexport const adminAPI = {\n  // Get all users\n  getAllUsers: (page = 1, limit = 20, filters = {}) => {\n    const params = new URLSearchParams({ page, limit, ...filters });\n    return api.get(`/admin/users?${params}`).then(res => res.data);\n  },\n\n  // Get all invoices\n  getAllInvoices: (page = 1, limit = 20, filters = {}) => {\n    const params = new URLSearchParams({ page, limit, ...filters });\n    return api.get(`/admin/invoices?${params}`).then(res => res.data);\n  },\n\n  // Approve/reject KYC\n  updateKYCStatus: (userId, status, remarks) =>\n    api.put(`/admin/kyc/${userId}`, { status, remarks }).then(res => res.data),\n\n  // Approve/reject invoice\n  updateInvoiceStatus: (invoiceId, status, remarks) =>\n    api.put(`/admin/invoices/${invoiceId}/status`, { status, remarks }).then(res => res.data),\n\n  // Get platform analytics\n  getPlatformAnalytics: () =>\n    api.get('/admin/analytics').then(res => res.data),\n\n  // Manage user account\n  manageUserAccount: (userId, action, reason) =>\n    api.post(`/admin/users/${userId}/manage`, { action, reason }).then(res => res.data)\n};\n\n// Utility functions\nexport const uploadFile = async (file, type = 'document') => {\n  const formData = new FormData();\n  formData.append('file', file);\n  formData.append('type', type);\n  \n  return api.post('/upload', formData, {\n    headers: { 'Content-Type': 'multipart/form-data' }\n  }).then(res => res.data);\n};\n\nexport const downloadFile = (fileId, filename) => {\n  return api.get(`/files/${fileId}`, {\n    responseType: 'blob'\n  }).then(response => {\n    const url = window.URL.createObjectURL(new Blob([response.data]));\n    const link = document.createElement('a');\n    link.href = url;\n    link.setAttribute('download', filename);\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n    window.URL.revokeObjectURL(url);\n  });\n};\n\n// WebSocket connection helper\nexport const createWebSocketConnection = (token) => {\n  const wsUrl = process.env.REACT_APP_WS_URL || 'ws://localhost:5000';\n  const socket = new WebSocket(`${wsUrl}?token=${token}`);\n  \n  socket.onopen = () => {\n    console.log('WebSocket connected');\n  };\n  \n  socket.onerror = (error) => {\n    console.error('WebSocket error:', error);\n  };\n  \n  socket.onclose = () => {\n    console.log('WebSocket disconnected');\n  };\n  \n  return socket;\n};\n\nexport default api;